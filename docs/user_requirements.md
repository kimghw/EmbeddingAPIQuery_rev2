# 사용자 요구사항

## 프로젝트 개요
Microsoft Graph API를 통해 이메일 변경사항(수신, 수정, 삭제 등)을 실시간 혹은 주기적으로 감지하고, 필요한 정보를 외부 API로 전송(또는 DB 저장)하는 시스템을 구축.

## 주요 요구사항

### [✓] 1. 다중 계정/설정 관리
- 여러 사용자(또는 여러 Office 365 계정)에 대해 인증, 계정 등록/제거, 설정 변경 가능

### [✓] 2. Graph API 인증/연동
- OAuth 2.0 Authorization Code Flow를 통해 Microsoft Graph API 접근 토큰 발급 및 갱신

### [✓] 3. 이메일 변경사항 감지 및 분석
- DeltaLink, 웹훅(Webhook) 등을 통해 수신되는 메일 변경사항을 파악하고 DB 기록 또는 알림 전송

### [✓] 4. 외부 API 전송
- 감지된 메일 변경 정보를 특정 REST API로 전송(페이로드 구성, 재시도, 오류 처리 포함)

### [✓] 5. 데이터베이스 관리
- 이메일 전송 이력, 처리 상태, 결과를 DB에 저장/조회, 오래된 이력 삭제 기능

### [✓] 6. CLI/REST API
- 동일한 비즈니스 로직을 공유하며, CLI나 REST API 어느 인터페이스든 사용자가 선택적으로 이용 가능

### [✓] 7. 모듈화 및 확장성
- 사용자 요구에 따라 GMail API로 교체, 혹은 다른 외부 API로 교체 등, 어댑터 교체가 용이해야 함

### [✓] 8. Logging/Monitoring
- 핵심 이벤트와 예외 상황을 공통 로깅 포맷으로 관리, 필요시 Sentry 등 연결

## 기술 요구사항

### 아키텍처
- 클린 아키텍처(Clean Architecture) 적용
- 얇은 어댑터 구조(Thin Adapter) 채택
- 비즈니스 로직(Core)과 인프라(어댑터) 의존성 분리

### 진입점
- CLI 인터페이스 (Typer 사용)
- FastAPI REST API 인터페이스
- 동일한 Core 로직 공유

### 데이터 관리
- Pydantic 모델 기반 데이터 검증
- Repository 패턴 적용
- 의존성 주입(DI) 구현

### 환경 설정
- .env 파일 기반 설정 관리
- 환경별 설정 분기 (dev/staging/prod)
- 민감 정보 환경변수 관리

## 최종 업데이트
2025-05-24
